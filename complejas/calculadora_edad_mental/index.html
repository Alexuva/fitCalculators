<style>
    input:not(:placeholder-shown):invalid,
    select:invalid:not(:focus) {
        border: 1px solid red !important;
    }
</style>

<h1>Calculadora de Edad Mental</h1>

<form class="form-container">
    <p style="margin-bottom: 20px; text-align: center; font-style: italic;">
        Calcula tu edad mental basándote en tu edad cronológica y factores de estilo de vida que impactan en la salud cerebral.
    </p>

    <div class="flex">
        <div>
            <label><span>Edad cronológica (años)</span></label>
            <input type="text" id="age" name="age_input" placeholder="Ej: 35" required>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Haces ejercicio físico regular?</span></label>
            <select id="exercise" type="select" name="exercise_input" required>
                <option disabled selected>Selecciona</option>
                <option value="-5">Sí, más de 4 veces por semana</option>
                <option value="-3">Sí, 2-4 veces por semana</option>
                <option value="0">Ocasionalmente (1 vez por semana o menos)</option>
                <option value="3">No hago ejercicio</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Cómo es tu alimentación?</span></label>
            <select id="diet" type="select" name="diet_input" required>
                <option disabled selected>Selecciona</option>
                <option value="-4">Muy saludable (muchas frutas, verduras, pescado, sin procesados)</option>
                <option value="-2">Saludable (equilibrada, algunos procesados)</option>
                <option value="0">Normal (mitad saludable, mitad procesados)</option>
                <option value="3">Poco saludable (muchos procesados, pocos vegetales)</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Cuántas horas duermes de media?</span></label>
            <select id="sleep" type="select" name="sleep_input" required>
                <option disabled selected>Selecciona</option>
                <option value="-3">7-9 horas de calidad</option>
                <option value="0">6-7 horas</option>
                <option value="2">5-6 horas</option>
                <option value="4">Menos de 5 horas</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Fumas?</span></label>
            <select id="tobacco" type="select" name="tobacco_input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, nunca he fumado</option>
                <option value="2">Ex-fumador (dejé hace más de 5 años)</option>
                <option value="4">Ex-fumador (dejé hace menos de 5 años)</option>
                <option value="7">Sí, fumo actualmente</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Consumes alcohol?</span></label>
            <select id="alcohol" type="select" name="alcohol_input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No bebo o muy ocasionalmente</option>
                <option value="1">Moderado (1-2 copas, 1-2 veces por semana)</option>
                <option value="3">Regular (3-5 copas por semana)</option>
                <option value="5">Frecuente o excesivo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Cómo gestionas el estrés?</span></label>
            <select id="stress" type="select" name="stress_input" required>
                <option disabled selected>Selecciona</option>
                <option value="-3">Muy bien, practico técnicas de relajación</option>
                <option value="-1">Bien, lo gestiono sin problemas</option>
                <option value="2">Regular, me cuesta manejarlo</option>
                <option value="4">Mal, estoy constantemente estresado/a</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Realizas actividades de estimulación mental?</span></label>
            <select id="mentalActivity" type="select" name="mentalActivity_input" required>
                <option disabled selected>Selecciona</option>
                <option value="-4">Sí, frecuentemente (lectura, aprendizaje, puzzles, idiomas)</option>
                <option value="-2">Ocasionalmente</option>
                <option value="0">Rara vez</option>
                <option value="2">Nunca, rutina muy repetitiva</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Tienes buenas relaciones sociales?</span></label>
            <select id="social" type="select" name="social_input" required>
                <option disabled selected>Selecciona</option>
                <option value="-3">Sí, tengo buena red social y contacto frecuente</option>
                <option value="-1">Sí, tengo contactos pero no muy frecuentes</option>
                <option value="1">Limitadas, poca interacción social</option>
                <option value="3">Muy aislado/a socialmente</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>¿Tienes alguna condición de salud crónica?</span></label>
            <select id="health" type="select" name="health_input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, estoy sano/a</option>
                <option value="2">Sí, una condición controlada</option>
                <option value="4">Sí, múltiples condiciones</option>
                <option value="6">Sí, condiciones no controladas</option>
            </select>
        </div>
    </div>

    <button id="calculate-btn" type="submit" value="Calcular" class="btn-calculate">
        Calcular mi edad mental
    </button>
</form>

<p class="result" style="visibility: hidden;"></p>

<script type="text/javascript">
    (function() {

        const INTEGERS_REGEX = /^\d+$/;

        class MentalAgeCalculator {
            _chronologicalAge;
            _exercise;
            _diet;
            _sleep;
            _tobacco;
            _alcohol;
            _stress;
            _mentalActivity;
            _social;
            _health;

            constructor(chronologicalAge, exercise, diet, sleep, tobacco, alcohol, stress, mentalActivity, social, health) {
                this._chronologicalAge = chronologicalAge;
                this._exercise = exercise;
                this._diet = diet;
                this._sleep = sleep;
                this._tobacco = tobacco;
                this._alcohol = alcohol;
                this._stress = stress;
                this._mentalActivity = mentalActivity;
                this._social = social;
                this._health = health;
            }

            get mentalAge() {
                const adjustment = this._exercise + this._diet + this._sleep + this._tobacco +
                                 this._alcohol + this._stress + this._mentalActivity + this._social + this._health;

                const calculatedAge = this._chronologicalAge + adjustment;
                return Math.max(18, Math.round(calculatedAge));
            }

            get difference() {
                return this.mentalAge - this._chronologicalAge;
            }

            get category() {
                const diff = this.difference;

                if (diff <= -8) {
                    return 'juvenil';
                } else if (diff <= -2) {
                    return 'equilibrada';
                } else if (diff <= 4) {
                    return 'madura';
                } else {
                    return 'conservadora';
                }
            }

            get interpretiveMessage() {
                const category = this.category;

                if (category === 'juvenil') {
                    return 'Tienes una mente abierta y curiosa, con alta adaptabilidad y entusiasmo por lo nuevo.';
                } else if (category === 'equilibrada') {
                    return 'Combinas flexibilidad con estabilidad emocional; te adaptas bien sin perder foco.';
                } else if (category === 'madura') {
                    return 'Tu pensamiento es estable y reflexivo; valoras la planificación y la seguridad.';
                } else {
                    return 'Predomina la prudencia y el apego a lo conocido; revisa si el exceso de rutina limita tu disfrute.';
                }
            }
        }

        const FORM = document.querySelector('.form-container');
        const RESULT_BOX = document.querySelector('.result');
        const CALCULATE_BTN = document.querySelector('#calculate-btn');
        const AGE_INPUT = document.getElementById('age');
        const SELECTS = document.querySelectorAll('select');

        // Validación del input de edad
        AGE_INPUT.addEventListener('input', () => {
            if (AGE_INPUT.value === '') {
                AGE_INPUT.setCustomValidity('');
                return;
            }

            if (!INTEGERS_REGEX.test(AGE_INPUT.value)) {
                AGE_INPUT.setCustomValidity('Introduce un número entero válido');
                AGE_INPUT.reportValidity();
                return;
            }

            const value = parseInt(AGE_INPUT.value);
            if (value < 18 || value > 100 || isNaN(value)) {
                AGE_INPUT.setCustomValidity('La edad debe estar entre 18 y 100 años');
                AGE_INPUT.reportValidity();
            } else {
                AGE_INPUT.setCustomValidity('');
            }
        });

        SELECTS.forEach(select => {
            select.addEventListener('change', () => {
                if (select.value !== "" && select.selectedIndex !== 0) {
                    select.setCustomValidity('');
                }
            });
        });

        FORM.addEventListener('submit', (e) => {
            e.preventDefault();

            let isValid = true;

            // Validar edad
            if (AGE_INPUT.value === '') {
                AGE_INPUT.setCustomValidity('Por favor, introduce tu edad');
                AGE_INPUT.reportValidity();
                isValid = false;
            } else if (!INTEGERS_REGEX.test(AGE_INPUT.value)) {
                AGE_INPUT.setCustomValidity('Introduce un número entero válido');
                AGE_INPUT.reportValidity();
                isValid = false;
            } else {
                const age = parseInt(AGE_INPUT.value);
                if (age < 18 || age > 100 || isNaN(age)) {
                    AGE_INPUT.setCustomValidity('La edad debe estar entre 18 y 100 años');
                    AGE_INPUT.reportValidity();
                    isValid = false;
                } else {
                    AGE_INPUT.setCustomValidity('');
                }
            }

            // Validar selects
            SELECTS.forEach(select => {
                if (select.value === "" || select.selectedIndex === 0) {
                    select.setCustomValidity('Por favor, selecciona una opción');
                    select.reportValidity();
                    isValid = false;
                } else {
                    select.setCustomValidity('');
                }
            });

            if (!isValid) return;

            CALCULATE_BTN.innerHTML = 'Calculando...';
            RESULT_BOX.style.visibility = 'hidden';

            const age = parseInt(AGE_INPUT.value);
            const calculator = new MentalAgeCalculator(
                age,
                parseInt(document.getElementById('exercise').value),
                parseInt(document.getElementById('diet').value),
                parseInt(document.getElementById('sleep').value),
                parseInt(document.getElementById('tobacco').value),
                parseInt(document.getElementById('alcohol').value),
                parseInt(document.getElementById('stress').value),
                parseInt(document.getElementById('mentalActivity').value),
                parseInt(document.getElementById('social').value),
                parseInt(document.getElementById('health').value)
            );

            const mentalAge = calculator.mentalAge;
            const category = calculator.category;
            const message = calculator.interpretiveMessage;

            setTimeout(() => {
                RESULT_BOX.scrollIntoView({ behavior: 'smooth', block: 'center' });
                CALCULATE_BTN.innerHTML = 'Calcular mi edad mental';
                RESULT_BOX.style.visibility = 'visible';

                let html = `<span>Tu edad mental estimada es <strong>${mentalAge} años</strong>.</span><br><br>`;
                html += `<span>Categoría: <strong>${category}</strong>.</span><br><br>`;
                html += `<span>${message}</span><br><br>`;
                html += `<span style="font-style: italic; font-size: 0.9em;">Este resultado es orientativo y no mide inteligencia ni edad biológica. Una edad mental distinta a la biológica no es positiva ni negativa; refleja tu estilo de pensamiento actual.</span>`;

                RESULT_BOX.innerHTML = html;
            }, 500);
        });

    })();
</script>
