<h1>Calculadora de Densidad Nutricional</h1>

<form class="form-container">
    <p style="margin-bottom: 20px; text-align: center; font-style: italic;">
        Calcula la densidad nutricional de un alimento según su aporte de nutrientes por cada 100 kcal.
    </p>

    <div class="flex">
        <div>
            <label><span>Calorías (kcal)</span></label>
            <input type="number" id="calorias" min="0" step="0.1" placeholder="0" required>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>Proteína (g)</span></label>
            <input type="number" id="proteina" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Fibra (g)</span></label>
            <input type="number" id="fibra" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Vitamina C (mg)</span></label>
            <input type="number" id="vitaminaC" min="0" step="0.1" value="0">
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>Vitamina A (µg)</span></label>
            <input type="number" id="vitaminaA" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Hierro (mg)</span></label>
            <input type="number" id="hierro" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Calcio (mg)</span></label>
            <input type="number" id="calcio" min="0" step="0.1" value="0">
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>Potasio (mg)</span></label>
            <input type="number" id="potasio" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Magnesio (mg)</span></label>
            <input type="number" id="magnesio" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Vitamina E (mg)</span></label>
            <input type="number" id="vitaminaE" min="0" step="0.1" value="0">
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>Folato (µg)</span></label>
            <input type="number" id="folato" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Vitamina B12 (µg)</span></label>
            <input type="number" id="vitaminaB12" min="0" step="0.1" value="0">
        </div>
        <div>
            <label><span>Zinc (mg)</span></label>
            <input type="number" id="zinc" min="0" step="0.1" value="0">
        </div>
    </div>

    <button id="calculate-btn" type="submit" value="Calcular" class="btn-calculate">
        Calcular densidad nutricional
    </button>
</form>

<p class="result" style="visibility: hidden;"></p>

<script type="text/javascript">
    (function() {

        class NutritionalDensityCalculator {
            _calories;
            _protein;
            _fiber;
            _vitaminC;
            _vitaminA;
            _iron;
            _calcium;
            _potassium;
            _magnesium;
            _vitaminE;
            _folate;
            _vitaminB12;
            _zinc;

            constructor(calories, protein, fiber, vitaminC, vitaminA, iron, calcium, potassium, magnesium, vitaminE, folate, vitaminB12, zinc) {
                this._calories = calories;
                this._protein = protein;
                this._fiber = fiber;
                this._vitaminC = vitaminC;
                this._vitaminA = vitaminA;
                this._iron = iron;
                this._calcium = calcium;
                this._potassium = potassium;
                this._magnesium = magnesium;
                this._vitaminE = vitaminE;
                this._folate = folate;
                this._vitaminB12 = vitaminB12;
                this._zinc = zinc;
            }

            get densityScore() {
                if (this._calories === 0) return 0;

                // Valores de referencia diarios (RDA)
                const RDA = {
                    protein: 50,        // g
                    fiber: 25,          // g
                    vitaminC: 80,       // mg
                    vitaminA: 800,      // µg
                    iron: 14,           // mg
                    calcium: 800,       // mg
                    potassium: 2000,    // mg
                    magnesium: 375,     // mg
                    vitaminE: 12,       // mg
                    folate: 200,        // µg
                    vitaminB12: 2.5,    // µg
                    zinc: 10            // mg
                };

                // Calcular % RDA por cada 100 kcal
                const factor = 100 / this._calories;

                const percentages = {
                    protein: (this._protein * factor / RDA.protein) * 100,
                    fiber: (this._fiber * factor / RDA.fiber) * 100,
                    vitaminC: (this._vitaminC * factor / RDA.vitaminC) * 100,
                    vitaminA: (this._vitaminA * factor / RDA.vitaminA) * 100,
                    iron: (this._iron * factor / RDA.iron) * 100,
                    calcium: (this._calcium * factor / RDA.calcium) * 100,
                    potassium: (this._potassium * factor / RDA.potassium) * 100,
                    magnesium: (this._magnesio * factor / RDA.magnesium) * 100,
                    vitaminE: (this._vitaminE * factor / RDA.vitaminE) * 100,
                    folate: (this._folate * factor / RDA.folate) * 100,
                    vitaminB12: (this._vitaminB12 * factor / RDA.vitaminB12) * 100,
                    zinc: (this._zinc * factor / RDA.zinc) * 100
                };

                // Promedio de todos los porcentajes
                const values = Object.values(percentages);
                const sum = values.reduce((acc, val) => acc + val, 0);
                const average = sum / values.length;

                return Math.round(average * 10) / 10;
            }

            get category() {
                const score = this.densityScore;

                if (score >= 50) {
                    return {
                        name: 'Muy alta densidad nutricional',
                        description: 'Excelente alimento. Aporta muchos nutrientes con pocas calorías.',
                        color: '#4CAF50'
                    };
                } else if (score >= 25) {
                    return {
                        name: 'Alta densidad nutricional',
                        description: 'Buen alimento. Tiene un buen equilibrio entre nutrientes y calorías.',
                        color: '#8BC34A'
                    };
                } else if (score >= 10) {
                    return {
                        name: 'Densidad nutricional moderada',
                        description: 'Alimento aceptable, pero podría ser más nutritivo.',
                        color: '#FFC107'
                    };
                } else {
                    return {
                        name: 'Baja densidad nutricional',
                        description: 'Alimento poco nutritivo. Aporta pocas vitaminas y minerales.',
                        color: '#FF5722'
                    };
                }
            }

            get topNutrients() {
                if (this._calories === 0) return [];

                const factor = 100 / this._calories;

                const RDA = {
                    protein: 50,
                    fiber: 25,
                    vitaminC: 80,
                    vitaminA: 800,
                    iron: 14,
                    calcium: 800,
                    potassium: 2000,
                    magnesium: 375,
                    vitaminE: 12,
                    folate: 200,
                    vitaminB12: 2.5,
                    zinc: 10
                };

                const nutrients = [
                    { name: 'Proteína', percent: (this._protein * factor / RDA.protein) * 100 },
                    { name: 'Fibra', percent: (this._fiber * factor / RDA.fiber) * 100 },
                    { name: 'Vitamina C', percent: (this._vitaminC * factor / RDA.vitaminC) * 100 },
                    { name: 'Vitamina A', percent: (this._vitaminA * factor / RDA.vitaminA) * 100 },
                    { name: 'Hierro', percent: (this._iron * factor / RDA.iron) * 100 },
                    { name: 'Calcio', percent: (this._calcium * factor / RDA.calcium) * 100 },
                    { name: 'Potasio', percent: (this._potassium * factor / RDA.potassium) * 100 },
                    { name: 'Magnesio', percent: (this._magnesio * factor / RDA.magnesium) * 100 },
                    { name: 'Vitamina E', percent: (this._vitaminE * factor / RDA.vitaminE) * 100 },
                    { name: 'Folato', percent: (this._folate * factor / RDA.folate) * 100 },
                    { name: 'Vitamina B12', percent: (this._vitaminB12 * factor / RDA.vitaminB12) * 100 },
                    { name: 'Zinc', percent: (this._zinc * factor / RDA.zinc) * 100 }
                ];

                return nutrients
                    .filter(n => n.percent > 0)
                    .sort((a, b) => b.percent - a.percent)
                    .slice(0, 3);
            }
        }

        const FORM = document.querySelector('.form-container');
        const RESULT_BOX = document.querySelector('.result');
        const CALCULATE_BTN = document.querySelector('#calculate-btn');

        FORM.addEventListener('submit', (e) => {
            e.preventDefault();

            const calories = parseFloat(document.getElementById('calorias').value);
            const protein = parseFloat(document.getElementById('proteina').value) || 0;
            const fiber = parseFloat(document.getElementById('fibra').value) || 0;
            const vitaminC = parseFloat(document.getElementById('vitaminaC').value) || 0;
            const vitaminA = parseFloat(document.getElementById('vitaminaA').value) || 0;
            const iron = parseFloat(document.getElementById('hierro').value) || 0;
            const calcium = parseFloat(document.getElementById('calcio').value) || 0;
            const potassium = parseFloat(document.getElementById('potasio').value) || 0;
            const magnesium = parseFloat(document.getElementById('magnesio').value) || 0;
            const vitaminE = parseFloat(document.getElementById('vitaminaE').value) || 0;
            const folate = parseFloat(document.getElementById('folato').value) || 0;
            const vitaminB12 = parseFloat(document.getElementById('vitaminaB12').value) || 0;
            const zinc = parseFloat(document.getElementById('zinc').value) || 0;

            if (!calories || calories <= 0) {
                alert('Por favor, introduce las calorías del alimento.');
                return;
            }

            CALCULATE_BTN.innerHTML = 'Calculando...';
            RESULT_BOX.style.visibility = 'hidden';

            const calculator = new NutritionalDensityCalculator(
                calories, protein, fiber, vitaminC, vitaminA, iron, calcium,
                potassium, magnesium, vitaminE, folate, vitaminB12, zinc
            );

            const score = calculator.densityScore;
            const category = calculator.category;
            const topNutrients = calculator.topNutrients;

            setTimeout(() => {
                RESULT_BOX.scrollIntoView({ behavior: 'smooth', block: 'center' });
                CALCULATE_BTN.innerHTML = 'Calcular densidad nutricional';
                RESULT_BOX.style.visibility = 'visible';

                let html = `<span>Puntuación de densidad nutricional: <strong>${score}%</strong></span><br><br>`;
                html += `<span style="color: ${category.color};"><strong>${category.name}</strong></span><br>`;
                html += `<span>${category.description}</span>`;

                if (topNutrients.length > 0) {
                    html += `<br><br><span style="font-weight: bold;">Nutrientes destacados (por 100 kcal):</span><br>`;
                    topNutrients.forEach(nutrient => {
                        html += `<span>• ${nutrient.name}: ${Math.round(nutrient.percent)}% RDA</span><br>`;
                    });
                }

                html += `<br><span style="font-style: italic; font-size: 0.9em;">Nota: El cálculo se basa en % de RDA por cada 100 kcal. Cuanto mayor, más nutritivo es el alimento.</span>`;

                RESULT_BOX.innerHTML = html;
            }, 500);
        });

    })();
</script>
