<style>
    input:not(:placeholder-shown):invalid,
    select:invalid:not(:focus) {
        border: 1px solid red !important;
    }
</style>

<h1>Test de Metabolismo: Rápido o Lento</h1>

<form class="form-container">
    <p style="margin-bottom: 20px; text-align: center; font-style: italic;">
        Responde a estas preguntas para estimar si tu metabolismo tiende a ser rápido o lento.
    </p>

    <div class="flex">
        <div>
            <label><span>1. ¿Con qué facilidad ganas peso?</span></label>
            <select id="q1" type="select" name="q1-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Muy difícil, como mucho y no engordo</option>
                <option value="1">Algo difícil, puedo comer bastante sin ganar peso</option>
                <option value="2">Normal, gano peso si como en exceso</option>
                <option value="3">Fácil, gano peso con facilidad</option>
                <option value="4">Muy fácil, engordo solo mirando la comida</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>2. ¿Con qué facilidad pierdes peso cuando haces dieta?</span></label>
            <select id="q2" type="select" name="q2-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Muy fácil, pierdo peso rápidamente</option>
                <option value="1">Fácil, veo resultados en pocas semanas</option>
                <option value="2">Normal, pierdo peso progresivamente</option>
                <option value="3">Difícil, me cuesta mucho perder peso</option>
                <option value="4">Muy difícil, apenas pierdo peso aunque haga dieta estricta</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>3. ¿Cómo es tu apetito en general?</span></label>
            <select id="q3" type="select" name="q3-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Siempre tengo hambre, necesito comer frecuentemente</option>
                <option value="1">Tengo buen apetito, como 4-5 veces al día</option>
                <option value="2">Apetito normal, 3 comidas al día</option>
                <option value="3">Apetito bajo, a veces se me olvida comer</option>
                <option value="4">Muy bajo, rara vez tengo hambre real</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>4. ¿Cómo es tu temperatura corporal?</span></label>
            <select id="q4" type="select" name="q4-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Siempre tengo calor, sudo fácilmente</option>
                <option value="1">Tengo más calor que la media</option>
                <option value="2">Normal, ni mucho frío ni calor</option>
                <option value="3">Tengo más frío que la media</option>
                <option value="4">Siempre tengo frío, manos y pies helados</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>5. ¿Cómo son tus niveles de energía durante el día?</span></label>
            <select id="q5" type="select" name="q5-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Muy altos, estoy siempre activo</option>
                <option value="1">Buenos, tengo energía la mayor parte del día</option>
                <option value="2">Normales, con altibajos</option>
                <option value="3">Bajos, me canso fácilmente</option>
                <option value="4">Muy bajos, siempre estoy cansado/a</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>6. ¿Cómo es tu constitución física natural?</span></label>
            <select id="q6" type="select" name="q6-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Ectomorfo: delgado, difícil ganar músculo y grasa</option>
                <option value="2">Mesomorfo: atlético, gano músculo fácilmente</option>
                <option value="4">Endomorfo: tendencia a acumular grasa, difícil perderla</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>7. ¿Cómo toleras los carbohidratos?</span></label>
            <select id="q7" type="select" name="q7-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Muy bien, puedo comer carbohidratos sin engordar</option>
                <option value="1">Bien, los tolero sin problema</option>
                <option value="2">Normal, debo moderarlos</option>
                <option value="3">Mal, engordo fácilmente con carbohidratos</option>
                <option value="4">Muy mal, los carbohidratos me hacen ganar peso inmediatamente</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>8. ¿Cuántas horas de sueño necesitas para sentirte descansado/a?</span></label>
            <select id="q8" type="select" name="q8-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Menos de 6 horas</option>
                <option value="1">6-7 horas</option>
                <option value="2">7-8 horas</option>
                <option value="3">8-9 horas</option>
                <option value="4">Más de 9 horas</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>9. ¿Cómo respondes al ejercicio físico?</span></label>
            <select id="q9" type="select" name="q9-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Me recupero rápido y tengo mucha resistencia</option>
                <option value="1">Me recupero bien</option>
                <option value="2">Normal, me recupero en 1-2 días</option>
                <option value="3">Me cuesta recuperarme</option>
                <option value="4">Muy lento, tardo días en recuperarme</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>10. ¿Cómo es tu digestión?</span></label>
            <select id="q10" type="select" name="q10-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Muy rápida, voy al baño varias veces al día</option>
                <option value="1">Rápida y regular</option>
                <option value="2">Normal, una vez al día</option>
                <option value="3">Lenta, a veces tengo estreñimiento</option>
                <option value="4">Muy lenta, estreñimiento frecuente</option>
            </select>
        </div>
    </div>

    <button id="calculate-btn" type="submit" value="Calcular" class="btn-calculate">
        Ver mi tipo de metabolismo
    </button>
</form>

<p class="result" style="visibility: hidden;"></p>

<script type="text/javascript">
    (function() {

        class MetabolismCalculator {
            _q1; _q2; _q3; _q4; _q5; _q6; _q7; _q8; _q9; _q10;

            constructor(q1, q2, q3, q4, q5, q6, q7, q8, q9, q10) {
                this._q1 = q1; this._q2 = q2; this._q3 = q3; this._q4 = q4; this._q5 = q5;
                this._q6 = q6; this._q7 = q7; this._q8 = q8; this._q9 = q9; this._q10 = q10;
            }

            get totalScore() {
                return this._q1 + this._q2 + this._q3 + this._q4 + this._q5 + this._q6 + this._q7 + this._q8 + this._q9 + this._q10;
            }

            get fastMetabolismScore() {
                const maxScore = 40;
                const invertedScore = maxScore - this.totalScore;
                return Math.round((invertedScore / maxScore) * 100);
            }

            get slowMetabolismScore() {
                const maxScore = 40;
                return Math.round((this.totalScore / maxScore) * 100);
            }

            get classification() {
                const fast = this.fastMetabolismScore;
                const slow = this.slowMetabolismScore;

                if (fast >= 60) {
                    return 'rápido';
                } else if (slow >= 60) {
                    return 'lento';
                } else {
                    return 'intermedio';
                }
            }

            get confidence() {
                const fast = this.fastMetabolismScore;
                const slow = this.slowMetabolismScore;
                const diff = Math.abs(fast - slow);

                if (diff >= 40) {
                    return 'alta';
                } else if (diff >= 20) {
                    return 'media';
                } else {
                    return 'baja';
                }
            }

            get interpretiveMessage() {
                const classification = this.classification;

                if (classification === 'rápido') {
                    return 'Tu organismo parece funcionar con alta eficiencia y gasto energético; prioriza suficiente ingesta calórica y proteínas.';
                } else if (classification === 'lento') {
                    return 'Tu metabolismo parece más conservador; prioriza descanso, ejercicio regular y comidas ligeras pero frecuentes.';
                } else {
                    return 'Tienes un metabolismo equilibrado y adaptable; ajusta tu alimentación según tu nivel de actividad.';
                }
            }
        }

        const FORM = document.querySelector('.form-container');
        const RESULT_BOX = document.querySelector('.result');
        const CALCULATE_BTN = document.querySelector('#calculate-btn');
        const SELECTS = document.querySelectorAll('select');

        SELECTS.forEach(select => {
            select.addEventListener('change', () => {
                if (select.value !== "" && select.selectedIndex !== 0) {
                    select.setCustomValidity('');
                }
            });
        });

        FORM.addEventListener('submit', (e) => {
            e.preventDefault();

            let isValid = true;
            SELECTS.forEach(select => {
                if (select.value === "" || select.selectedIndex === 0) {
                    select.setCustomValidity('Por favor, selecciona una opción');
                    select.reportValidity();
                    isValid = false;
                } else {
                    select.setCustomValidity('');
                }
            });

            if (!isValid) return;

            CALCULATE_BTN.innerHTML = 'Calculando...';
            RESULT_BOX.style.visibility = 'hidden';

            const calculator = new MetabolismCalculator(
                parseInt(document.getElementById('q1').value),
                parseInt(document.getElementById('q2').value),
                parseInt(document.getElementById('q3').value),
                parseInt(document.getElementById('q4').value),
                parseInt(document.getElementById('q5').value),
                parseInt(document.getElementById('q6').value),
                parseInt(document.getElementById('q7').value),
                parseInt(document.getElementById('q8').value),
                parseInt(document.getElementById('q9').value),
                parseInt(document.getElementById('q10').value)
            );

            const classification = calculator.classification;
            const fastScore = calculator.fastMetabolismScore;
            const slowScore = calculator.slowMetabolismScore;
            const confidence = calculator.confidence;
            const message = calculator.interpretiveMessage;

            setTimeout(() => {
                RESULT_BOX.scrollIntoView({ behavior: 'smooth', block: 'center' });
                CALCULATE_BTN.innerHTML = 'Ver mi tipo de metabolismo';
                RESULT_BOX.style.visibility = 'visible';

                let html = `<span>Tu metabolismo estimado es <strong>${classification}</strong>.</span><br><br>`;
                html += `<span>Puntuación metabolismo rápido: <strong>${fastScore}/100</strong>.<br>`;
                html += `Puntuación metabolismo lento: <strong>${slowScore}/100</strong>.<br>`;
                html += `Nivel de confianza: <strong>${confidence}</strong>.</span><br><br>`;
                html += `<span>${message}</span><br><br>`;
                html += `<span style="font-style: italic; font-size: 0.9em;">Los valores fisiológicos son orientativos; no sustituyen una valoración médica. El test refleja patrones generales, no el gasto energético exacto.</span>`;

                RESULT_BOX.innerHTML = html;
            }, 500);
        });

    })();
</script>
