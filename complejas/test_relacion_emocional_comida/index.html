<style>
    input:not(:placeholder-shown):invalid,
    select:invalid:not(:focus) {
        border: 1px solid red !important;
    }
</style>

<h1>Test de Relación Emocional con la Comida</h1>

<form class="form-container">
    <p style="margin-bottom: 20px; text-align: center; font-style: italic;">
        Responde con sinceridad para evaluar tu relación emocional con la comida y detectar posibles patrones poco saludables.
    </p>

    <div class="flex">
        <div>
            <label><span>1. ¿Con qué frecuencia piensas en comida durante el día?</span></label>
            <select id="q1" type="select" name="q1-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Solo cuando tengo hambre o toca comer</option>
                <option value="1">Ocasionalmente, pero no me obsesiona</option>
                <option value="2">Bastante a menudo, incluso sin hambre</option>
                <option value="3">Constantemente, es algo que domina mis pensamientos</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>2. ¿Cómo te sientes después de comer algo "prohibido" o fuera de tu dieta?</span></label>
            <select id="q2" type="select" name="q2-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Normal, sin culpa. Disfruto y sigo adelante</option>
                <option value="1">Un poco culpable, pero lo supero rápido</option>
                <option value="2">Muy culpable, me castigo mentalmente</option>
                <option value="3">Extremadamente culpable, arruina mi día y me siento fatal</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>3. ¿Usas la comida como recompensa o consuelo?</span></label>
            <select id="q3" type="select" name="q3-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Rara vez o nunca</option>
                <option value="1">Ocasionalmente, en situaciones especiales</option>
                <option value="2">Frecuentemente, es mi forma de sentirme mejor</option>
                <option value="3">Siempre, no sé gestionar emociones sin comida</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>4. ¿Has tenido episodios de atracones (comer mucho en poco tiempo, sin control)?</span></label>
            <select id="q4" type="select" name="q4-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Rara vez (1-2 veces al año)</option>
                <option value="2">Ocasionalmente (1 vez al mes o menos)</option>
                <option value="3">Frecuentemente (varias veces al mes o semanalmente)</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>5. ¿Comes a escondidas o te avergüenza que otros vean lo que comes?</span></label>
            <select id="q5" type="select" name="q5-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca, como abiertamente</option>
                <option value="1">Rara vez, solo en alguna ocasión</option>
                <option value="2">A veces, me da vergüenza</option>
                <option value="3">Frecuentemente, escondo lo que como</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>6. ¿Clasificas los alimentos como "buenos" o "malos" de forma rígida?</span></label>
            <select id="q6" type="select" name="q6-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, todos los alimentos pueden tener un lugar</option>
                <option value="1">Un poco, pero soy flexible</option>
                <option value="2">Bastante, divido claramente entre buenos y malos</option>
                <option value="3">Totalmente, tengo listas mentales muy estrictas</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>7. ¿Cómo afecta tu peso o imagen corporal a tu estado de ánimo?</span></label>
            <select id="q7" type="select" name="q7-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Poco o nada, mi autoestima no depende de eso</option>
                <option value="1">Un poco, a veces me afecta</option>
                <option value="2">Bastante, condiciona mi día a día</option>
                <option value="3">Totalmente, define mi valía personal</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>8. ¿Has usado purgas, laxantes, ejercicio excesivo o vómitos para compensar?</span></label>
            <select id="q8" type="select" name="q8-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Lo he pensado, pero nunca lo he hecho</option>
                <option value="2">Lo he hecho alguna vez</option>
                <option value="3">Lo hago con cierta frecuencia</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>9. ¿Tienes reglas alimentarias muy estrictas que te generan ansiedad si las rompes?</span></label>
            <select id="q9" type="select" name="q9-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, soy flexible</option>
                <option value="1">Tengo algunas pautas, pero no me estresan</option>
                <option value="2">Sí, tengo reglas estrictas que me causan ansiedad</option>
                <option value="3">Sí, son extremadamente rígidas y me controlan</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>10. ¿Evitas situaciones sociales (comidas, eventos) por miedo a comer?</span></label>
            <select id="q10" type="select" name="q10-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca, disfruto de eventos sociales</option>
                <option value="1">Rara vez, solo en casos excepcionales</option>
                <option value="2">A menudo, me genera ansiedad</option>
                <option value="3">Casi siempre, evito activamente estas situaciones</option>
            </select>
        </div>
    </div>

    <button id="calculate-btn" type="submit" value="Calcular" class="btn-calculate">
        Ver mi resultado
    </button>
</form>

<p class="result" style="visibility: hidden;"></p>

<script type="text/javascript">
    (function() {

        class EmotionalFoodRelationshipCalculator {
            _q1; _q2; _q3; _q4; _q5; _q6; _q7; _q8; _q9; _q10;

            constructor(q1, q2, q3, q4, q5, q6, q7, q8, q9, q10) {
                this._q1 = q1; this._q2 = q2; this._q3 = q3; this._q4 = q4; this._q5 = q5;
                this._q6 = q6; this._q7 = q7; this._q8 = q8; this._q9 = q9; this._q10 = q10;
            }

            get totalScore() {
                return this._q1 + this._q2 + this._q3 + this._q4 + this._q5 + this._q6 + this._q7 + this._q8 + this._q9 + this._q10;
            }

            get emotionalityScore() {
                const maxScore = 30;
                return Math.round((this.totalScore / maxScore) * 100);
            }

            get classification() {
                const score = this.emotionalityScore;

                if (score <= 25) {
                    return 'Predomina control consciente';
                } else if (score <= 50) {
                    return 'Equilibrio emocional/físico';
                } else if (score <= 75) {
                    return 'Alta influencia emocional';
                } else {
                    return 'Relación emocional intensa';
                }
            }

            get interpretiveMessage() {
                const classification = this.classification;

                if (classification === 'Predomina control consciente') {
                    return 'Tu alimentación parece responder principalmente a señales físicas. Mantén la atención plena para conservar este equilibrio.';
                } else if (classification === 'Equilibrio emocional/físico') {
                    return 'Usas la comida de forma flexible; ocasionalmente influida por emociones, pero con buena autorregulación.';
                } else if (classification === 'Alta influencia emocional') {
                    return 'Tus emociones afectan con frecuencia tu forma de comer. Identificar los detonantes emocionales puede ayudarte a reducir la impulsividad.';
                } else {
                    return 'La comida parece una vía de alivio emocional. Practicar técnicas de gestión emocional o mindfulness alimentario puede ayudarte.';
                }
            }
        }

        const FORM = document.querySelector('.form-container');
        const RESULT_BOX = document.querySelector('.result');
        const CALCULATE_BTN = document.querySelector('#calculate-btn');
        const SELECTS = document.querySelectorAll('select');

        SELECTS.forEach(select => {
            select.addEventListener('change', () => {
                if (select.value !== "" && select.selectedIndex !== 0) {
                    select.setCustomValidity('');
                }
            });
        });

        FORM.addEventListener('submit', (e) => {
            e.preventDefault();

            let isValid = true;
            SELECTS.forEach(select => {
                if (select.value === "" || select.selectedIndex === 0) {
                    select.setCustomValidity('Por favor, selecciona una opción');
                    select.reportValidity();
                    isValid = false;
                } else {
                    select.setCustomValidity('');
                }
            });

            if (!isValid) return;

            CALCULATE_BTN.innerHTML = 'Calculando...';
            RESULT_BOX.style.visibility = 'hidden';

            const calculator = new EmotionalFoodRelationshipCalculator(
                parseInt(document.getElementById('q1').value),
                parseInt(document.getElementById('q2').value),
                parseInt(document.getElementById('q3').value),
                parseInt(document.getElementById('q4').value),
                parseInt(document.getElementById('q5').value),
                parseInt(document.getElementById('q6').value),
                parseInt(document.getElementById('q7').value),
                parseInt(document.getElementById('q8').value),
                parseInt(document.getElementById('q9').value),
                parseInt(document.getElementById('q10').value)
            );

            const emotionalityScore = calculator.emotionalityScore;
            const classification = calculator.classification;
            const message = calculator.interpretiveMessage;

            setTimeout(() => {
                RESULT_BOX.scrollIntoView({ behavior: 'smooth', block: 'center' });
                CALCULATE_BTN.innerHTML = 'Ver mi resultado';
                RESULT_BOX.style.visibility = 'visible';

                let html = `<span>Tu puntuación de relación emocional con la comida es <strong>${emotionalityScore}/100</strong>.</span><br><br>`;
                html += `<span>Clasificación: <strong>${classification}</strong>.</span><br><br>`;
                html += `<span>${message}</span><br><br>`;
                html += `<span style="font-style: italic; font-size: 0.9em;">Este test es orientativo; no sustituye la evaluación de un profesional. Evita interpretarlo como diagnóstico clínico.</span>`;

                RESULT_BOX.innerHTML = html;
            }, 500);
        });

    })();
</script>
