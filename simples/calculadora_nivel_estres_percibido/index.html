<form class="form-container">
    <p style="margin-bottom: 20px; text-align: center; font-style: italic;">La Escala de Estrés Percibido (PSS) mide la percepción del estrés, es decir, el grado en que las situaciones de la vida se valoran como impredecibles, incontrolables y sobrecargadas. Este test te ayudará a reflexionar sobre tus sentimientos y pensamientos durante el último mes.</p>
    <p style="margin-bottom: 20px; text-align: center; font-weight: bold; font-size: 0.9em;">⚠️ Esta escala es una herramienta de autoevaluación para medir percepciones subjetivas. No constituye un diagnóstico clínico. Si tu nivel de estrés es alto, considera hablar con un profesional de la salud.</p>

    <div class="flex">
        <div>
            <label><span>1. ¿Con qué frecuencia has estado afectado/a por algo que ha ocurrido inesperadamente?</span></label>
            <select id="q1" type="select" name="q1-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="3">A menudo</option>
                <option value="4">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>2. ¿Con qué frecuencia te has sentido incapaz de controlar las cosas importantes en tu vida?</span></label>
            <select id="q2" type="select" name="q2-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="3">A menudo</option>
                <option value="4">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>3. ¿Con qué frecuencia te has sentido nervioso/a o estresado/a?</span></label>
            <select id="q3" type="select" name="q3-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="3">A menudo</option>
                <option value="4">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>4. ¿Con qué frecuencia has sentido que manejabas con éxito los pequeños problemas o molestias de la vida?</span></label>
            <select id="q4" type="select" name="q4-input" required>
                <option disabled selected>Selecciona</option>
                <option value="4">Nunca</option>
                <option value="3">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="1">A menudo</option>
                <option value="0">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>5. ¿Con qué frecuencia has sentido que las cosas te salían bien?</span></label>
            <select id="q5" type="select" name="q5-input" required>
                <option disabled selected>Selecciona</option>
                <option value="4">Nunca</option>
                <option value="3">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="1">A menudo</option>
                <option value="0">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>6. ¿Con qué frecuencia has pensado que no podías afrontar todas las cosas que tenías que hacer?</span></label>
            <select id="q6" type="select" name="q6-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="3">A menudo</option>
                <option value="4">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>7. ¿Con qué frecuencia has sido capaz de controlar las irritaciones en tu vida?</span></label>
            <select id="q7" type="select" name="q7-input" required>
                <option disabled selected>Selecciona</option>
                <option value="4">Nunca</option>
                <option value="3">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="1">A menudo</option>
                <option value="0">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>8. ¿Con qué frecuencia has sentido que estabas al tanto de todo?</span></label>
            <select id="q8" type="select" name="q8-input" required>
                <option disabled selected>Selecciona</option>
                <option value="4">Nunca</option>
                <option value="3">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="1">A menudo</option>
                <option value="0">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>9. ¿Con qué frecuencia te has enfadado por cosas que estaban fuera de tu control?</span></label>
            <select id="q9" type="select" name="q9-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="3">A menudo</option>
                <option value="4">Muy a menudo</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>10. ¿Con qué frecuencia has sentido que las dificultades se acumulaban tanto que no podías superarlas?</span></label>
            <select id="q10" type="select" name="q10-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Nunca</option>
                <option value="1">Casi nunca</option>
                <option value="2">De vez en cuando</option>
                <option value="3">A menudo</option>
                <option value="4">Muy a menudo</option>
            </select>
        </div>
    </div>

    <button id="calculate-btn" type="submit" value="Calcular" class="btn-calculate">
        Ver mi nivel de estrés
    </button>
</form>

<p class="result" style="visibility: hidden;"></p>

<script type="text/javascript">
    (function() {

        //Inputs de las preguntas
        const Q1 = document.querySelector('#q1');
        const Q2 = document.querySelector('#q2');
        const Q3 = document.querySelector('#q3');
        const Q4 = document.querySelector('#q4');
        const Q5 = document.querySelector('#q5');
        const Q6 = document.querySelector('#q6');
        const Q7 = document.querySelector('#q7');
        const Q8 = document.querySelector('#q8');
        const Q9 = document.querySelector('#q9');
        const Q10 = document.querySelector('#q10');

        //Caja con el resultado
        const RESULT_BOX = document.querySelector('.result');

        //Botón de calcular
        const CALCULATE_BTN = document.querySelector('#calculate-btn');

        //Formulario
        const FORM = document.querySelector('.form-container');

        //Comprobar que ha introducido valor en los select
        const SELECTS = document.querySelectorAll('select');
        SELECTS.forEach(select => {
            select.addEventListener('change', () => {
                if (select.value !== "" && select.selectedIndex !== 0) {
                    select.setCustomValidity('');
                }
            });
        });

        FORM.addEventListener('submit', (e)=>{
            e.preventDefault();

            const selects = document.querySelectorAll('select');
            let isValid = true;

            selects.forEach(select => {
                if (select.value === "" || select.selectedIndex === 0) {
                    select.setCustomValidity('Por favor, selecciona una opción');
                    select.reportValidity();
                    isValid = false;
                } else {
                    select.setCustomValidity('');
                }
            });

            if (!isValid) {
                return;
            }

            //Cambiar texto botón
            CALCULATE_BTN.innerHTML = 'Calculando...';

            //Ocultar resultado anterior
            RESULT_BOX.style.visibility = 'hidden';

            // Obtener valores de todas las preguntas
            const q1 = parseInt(Q1.value);
            const q2 = parseInt(Q2.value);
            const q3 = parseInt(Q3.value);
            const q4 = parseInt(Q4.value);
            const q5 = parseInt(Q5.value);
            const q6 = parseInt(Q6.value);
            const q7 = parseInt(Q7.value);
            const q8 = parseInt(Q8.value);
            const q9 = parseInt(Q9.value);
            const q10 = parseInt(Q10.value);

            const CALCULATOR = new StressCalculator(q1, q2, q3, q4, q5, q6, q7, q8, q9, q10);
            const result = CALCULATOR.stressLevel;

            setTimeout(()=>{

                //Scroll smooth hasta el resultado
                RESULT_BOX.scrollIntoView({behavior: 'smooth', block: 'center'});

                //Volver a poner el texto en el boton
                CALCULATE_BTN.innerHTML = 'Ver mi nivel de estrés';

                //Mostrar el resultado
                RESULT_BOX.style.visibility = 'visible';

                let warningMessage = '';
                if (result.showWarning) {
                    warningMessage = '<br><br><span style="font-style: italic;">Sería recomendable que buscaras ayuda profesional.</span>';
                }

                RESULT_BOX.innerHTML = `
                    <span>Tu percepción es que tienes estrés <strong>${result.level}</strong>.</span>${warningMessage}
                `;

            }, 500)

        })

    })();

    class StressCalculator {
        _q1;
        _q2;
        _q3;
        _q4;
        _q5;
        _q6;
        _q7;
        _q8;
        _q9;
        _q10;

        constructor(q1, q2, q3, q4, q5, q6, q7, q8, q9, q10) {
            this._q1 = q1;
            this._q2 = q2;
            this._q3 = q3;
            this._q4 = q4;
            this._q5 = q5;
            this._q6 = q6;
            this._q7 = q7;
            this._q8 = q8;
            this._q9 = q9;
            this._q10 = q10;
        }

        get stressLevel() {
            const totalScore = this._q1 + this._q2 + this._q3 + this._q4 + this._q5 + this._q6 + this._q7 + this._q8 + this._q9 + this._q10;

            let level = '';
            let showWarning = false;

            if (totalScore <= 7) {
                level = 'muy bajo';
            } else if (totalScore >= 8 && totalScore <= 16) {
                level = 'bajo';
            } else if (totalScore >= 17 && totalScore <= 25) {
                level = 'moderado';
            } else if (totalScore >= 26 && totalScore <= 33) {
                level = 'alto';
                showWarning = true;
            } else {
                level = 'muy alto';
                showWarning = true;
            }

            return {
                totalScore,
                level,
                showWarning
            };
        }
    }
</script>
