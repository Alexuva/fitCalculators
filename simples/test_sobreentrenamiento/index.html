<form class="form-container">
    <p style="margin-bottom: 20px; text-align: center; font-style: italic;">El sobreentrenamiento no es solo sentirse cansado; es un síndrome complejo donde el cuerpo ya no puede recuperarse del estrés físico acumulado. Se manifiesta con un descenso del rendimiento y afecta a tu estado de ánimo, hormonas y salud general. Este test te ayudará a evaluar tu riesgo actual basándose en los indicadores clave.</p>
    <p style="margin-bottom: 20px; text-align: center; font-weight: bold; font-size: 0.9em;">Responde a cada pregunta pensando en cómo te has sentido durante las últimas 2-3 semanas en comparación con tu estado normal.</p>

    <div class="flex">
        <div>
            <label><span>1. ¿Cómo describirías tu estado de ánimo general?</span></label>
            <select id="q1" type="select" name="q1-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Positivo y enérgico</option>
                <option value="1">Apático o irritable con más facilidad que antes.</option>
                <option value="2">Negativo, irascible y/o con un humor muy cambiante.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>2. ¿Cómo es la calidad de tu sueño?</span></label>
            <select id="q2" type="select" name="q2-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Buena, duermo profundamente y me levanto descansado/a.</option>
                <option value="1">Regular, me cuesta dormir o me despierto por la noche.</option>
                <option value="2">Mala, duermo mal y me levanto con la sensación de no haber descansado.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>3. ¿Tienes una frecuencia cardíaca en reposo por la mañana más alta de lo normal para ti?</span></label>
            <select id="q3" type="select" name="q3-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, es estable y normal.</option>
                <option value="1">No tengo datos de mi frecuencia cardiaca por las mañanas</option>
                <option value="1">A veces es un poco más alta (5–10 lat/min más).</option>
                <option value="2">Sí, es frecuentemente más alta de lo normal.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>4. ¿Cómo es tu apetito (patrones de alimentación)?</span></label>
            <select id="q4" type="select" name="q4-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Normal y saludable. Tengo una relación buena con la comida</option>
                <option value="1">Ha aumentado o disminuido ligeramente, con algún antojo más de lo normal.</option>
                <option value="2">He perdido el interés por la comida o tengo muchísima ansiedad por ella.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>5. ¿Has notado cambios en tu apetito sexual (libido)?</span></label>
            <select id="q5" type="select" name="q5-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, se mantiene como siempre.</option>
                <option value="1">Ha disminuido un poco.</option>
                <option value="2">Ha disminuido drásticamente o ha desaparecido.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>6. ¿Con qué frecuencia te pones enfermo (resfriados, infecciones leves)?</span></label>
            <select id="q6" type="select" name="q6-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Raramente, como siempre.</option>
                <option value="1">Más a menudo de lo habitual últimamente.</option>
                <option value="2">Constantemente, siento que mi sistema inmune está debilitado.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>7. ¿Te has hecho una analítica de sangre reciente que muestre valores alterados?</span></label>
            <select id="q7" type="select" name="q7-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Me he hecho una analítica recientemente, pero está todo bien.</option>
                <option value="1">No me he hecho ninguna analítica últimamente.</option>
                <option value="2">Sí, mi médico ha detectado alteraciones hormonales o de otro tipo.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>8. ¿Cómo son tus ganas y motivación para ir a entrenar?</span></label>
            <select id="q8" type="select" name="q8-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Altas, tengo ganas y disfruto.</option>
                <option value="1">Bajas, a menudo siento pereza o me cuesta empezar.</option>
                <option value="2">Nulas, ir a entrenar se ha convertido en una obligación pesada.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>9. ¿Cómo es tu progresión en los entrenamientos?</span></label>
            <select id="q9" type="select" name="q9-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Sigo mejorando y progresando.</option>
                <option value="1">Estoy estancado/a, me cuesta mucho mejorar.</option>
                <option value="2">Mi rendimiento ha empeorado notablemente.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>10. ¿Cómo sientes tu nivel de fatiga general durante el día (fuera del entrenamiento)?</span></label>
            <select id="q10" type="select" name="q10-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">Normal, me siento con energía la mayor parte del día.</option>
                <option value="1">Cansado/a, me falta energía por la tarde o necesito un extra.</option>
                <option value="2">Agotado/a, me siento cansado/a incluso después de descansar.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>11. ¿Sientes dolores musculares o de articulaciones más allá de lo normal tras entrenar (horas o días)?</span></label>
            <select id="q11" type="select" name="q11-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, solo las agujetas habituales.</option>
                <option value="1">Sí, siento dolores persistentes o agujetas que tardan mucho en irse.</option>
                <option value="2">Sí, tengo dolores constantes incluso en días de descanso.</option>
            </select>
        </div>
    </div>

    <div class="flex">
        <div>
            <label><span>12. A pesar de entrenar, ¿has notado cambios negativos en tu composición corporal?</span></label>
            <select id="q12" type="select" name="q12-input" required>
                <option disabled selected>Selecciona</option>
                <option value="0">No, mi composición mejora o se mantiene.</option>
                <option value="1">No estoy seguro/a, pero no veo los resultados esperados.</option>
                <option value="2">Sí, siento que pierdo músculo o acumulo grasa sin explicación.</option>
            </select>
        </div>
    </div>

    <button id="calculate-btn" type="submit" value="Calcular" class="btn-calculate">
        Ver mi nivel de recuperación
    </button>
</form>

<p class="result" style="visibility: hidden;"></p>

<script type="text/javascript">
    (function() {

        //Inputs de las preguntas
        const Q1 = document.querySelector('#q1');
        const Q2 = document.querySelector('#q2');
        const Q3 = document.querySelector('#q3');
        const Q4 = document.querySelector('#q4');
        const Q5 = document.querySelector('#q5');
        const Q6 = document.querySelector('#q6');
        const Q7 = document.querySelector('#q7');
        const Q8 = document.querySelector('#q8');
        const Q9 = document.querySelector('#q9');
        const Q10 = document.querySelector('#q10');
        const Q11 = document.querySelector('#q11');
        const Q12 = document.querySelector('#q12');

        //Caja con el resultado
        const RESULT_BOX = document.querySelector('.result');

        //Botón de calcular
        const CALCULATE_BTN = document.querySelector('#calculate-btn');

        //Formulario
        const FORM = document.querySelector('.form-container');

        //Comprobar que ha introducido valor en los select
        const SELECTS = document.querySelectorAll('select');
        SELECTS.forEach(select => {
            select.addEventListener('change', () => {
                if (select.value !== "" && select.selectedIndex !== 0) {
                    select.setCustomValidity('');
                }
            });
        });

        FORM.addEventListener('submit', (e)=>{
            e.preventDefault();

            const selects = document.querySelectorAll('select');
            let isValid = true;

            selects.forEach(select => {
                if (select.value === "" || select.selectedIndex === 0) {
                    select.setCustomValidity('Por favor, selecciona una opción');
                    select.reportValidity();
                    isValid = false;
                } else {
                    select.setCustomValidity('');
                }
            });

            if (!isValid) {
                return;
            }

            //Cambiar texto botón
            CALCULATE_BTN.innerHTML = 'Calculando...';

            //Ocultar resultado anterior
            RESULT_BOX.style.visibility = 'hidden';

            // Obtener valores de todas las preguntas
            const q1 = parseInt(Q1.value);
            const q2 = parseInt(Q2.value);
            const q3 = parseInt(Q3.value);
            const q4 = parseInt(Q4.value);
            const q5 = parseInt(Q5.value);
            const q6 = parseInt(Q6.value);
            const q7 = parseInt(Q7.value);
            const q8 = parseInt(Q8.value);
            const q9 = parseInt(Q9.value);
            const q10 = parseInt(Q10.value);
            const q11 = parseInt(Q11.value);
            const q12 = parseInt(Q12.value);

            const CALCULATOR = new OvertrainingCalculator(q1, q2, q3, q4, q5, q6, q7, q8, q9, q10, q11, q12);
            const result = CALCULATOR.recoveryLevel;

            setTimeout(()=>{

                //Scroll smooth hasta el resultado
                RESULT_BOX.scrollIntoView({behavior: 'smooth', block: 'center'});

                //Volver a poner el texto en el boton
                CALCULATE_BTN.innerHTML = 'Ver mi nivel de recuperación';

                //Mostrar el resultado
                RESULT_BOX.style.visibility = 'visible';

                RESULT_BOX.innerHTML = `
                    <span>Tienes un nivel de recuperación <strong>${result.level}</strong></span>
                `;

            }, 500)

        })

    })();

    class OvertrainingCalculator {
        _q1;
        _q2;
        _q3;
        _q4;
        _q5;
        _q6;
        _q7;
        _q8;
        _q9;
        _q10;
        _q11;
        _q12;

        constructor(q1, q2, q3, q4, q5, q6, q7, q8, q9, q10, q11, q12) {
            this._q1 = q1;
            this._q2 = q2;
            this._q3 = q3;
            this._q4 = q4;
            this._q5 = q5;
            this._q6 = q6;
            this._q7 = q7;
            this._q8 = q8;
            this._q9 = q9;
            this._q10 = q10;
            this._q11 = q11;
            this._q12 = q12;
        }

        get recoveryLevel() {
            const totalScore = this._q1 + this._q2 + this._q3 + this._q4 + this._q5 + this._q6 + this._q7 + this._q8 + this._q9 + this._q10 + this._q11 + this._q12;

            let level = '';

            if (totalScore <= 5) {
                level = 'óptima. No estás sobreentrenado/a.';
            } else if (totalScore >= 6 && totalScore <= 10) {
                level = 'buena, aunque mejorable. Riesgo bajo de sobreentrenamiento.';
            } else if (totalScore >= 11 && totalScore <= 15) {
                level = 'deficiente. Posible sobrecarga funcional.';
            } else if (totalScore >= 16 && totalScore <= 20) {
                level = 'bajo. Estás algo sobreentrenado/a.';
            } else {
                level = 'muy bajo. No te recuperas y estás sobreentrenado/a.';
            }

            return {
                totalScore,
                level
            };
        }
    }
</script>
